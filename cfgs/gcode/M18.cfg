[gcode_macro M18]
rename_existing: M18.1
gcode:
  {% if params.X is not defined and params.Y is not defined and params.Z is not defined and params.E is not defined %}
    SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
    SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
    SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
    SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
  {% else %}
    {% if params.X is defined %}
      SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
    {% endif %}
    {% if params.Y is defined %}
      SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
    {% endif %}
    {% if params.Z is defined %}
      SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=0
    {% endif %}
    {% if params.E is defined %}
      SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
    {% endif %}
  {% endif %}
