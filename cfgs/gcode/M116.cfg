# default:
#   M116 S2
[gcode_macro M116]
gcode:
    {% set tolerance = params.S|default(2)|float %}
    {% if params.S is not defined %}
        TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={printer.heater_bed.target - tolerance}
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={printer.extruder.target - tolerance}
        M300
    {% elif params.P is defined %}
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={printer.extruder.target - tolerance}
        M300
        M300
    {% elif params.H is defined %}
        TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={printer.heater_bed.target - tolerance}
        M300
        M300
        M300
    {% endif %}
